# Лабораторные работы №1-4 (Управление IT-проектами) #

Выполнил: Петрушин Влад, М8О-103М-20

## Сборка проекта ##

```bash
cmake configure .
cmake --build
```

## Запуск Docker-окружения ##

```bash
sudo docker-compose up -d
```

## Создание скрипта для заполнения шардов ##

Искуственно сгенерированный датасет, использовавшийся в лабораторных работах 1, 2, 3 необходимо разделить на 3 запроса для каждого из шардов:

```bash
./gen_data_sharding
```

Данный исполняемый файл генерирует скрипт gen_data_sharding.sql.

## Настройка базы данных ##

```bash
mysql -u test -p pzjqUkMnc7vfNHET -h 127.0.0.1 -P 6033 --comments
mysql> source shard_init.sql;
mysql> source db_scripts/gen_data_sharding.sql;
```

## Запуск сервера ##

Для запуска сервера следует выполнить команду:

```bash
sudo sh ./start.sh
```

## Запуск подписчика для очереди ##

Для запуска подписчика, читающего сообщения с очереди, следует выполнить команду:

```bash
sudo sh ./start_writer.sh
```

## Модульное тестирование (GTests) ##

Запуск модульных тестов осуществляется следующей командой:

```bash
./gtests
```

Для тестирования используется исходная таблица Person с последующей очисткой данных в каждом шарде по окончании работы gtests.

## Нагрузочное тестирование (wrk) ##

Нагрузочное тестирование производилось для 1, 2, 6 и 10 потоков при 50 подключениях в течение 30 секунд.
Были проведены тесты как на чтение данных, так и на их запись с помощью .lua-файла, передаваемого в качестве аргумента для wrk.

Запуск тестов (следует проводить при работе сервера и подписчика):

```bash
sudo sh ./tests.sh
```

- Threads - количество потоков;
- Requests/sec - количество запросов в секунду;
- Latency(ms) - задержка в миллисекундах.

Запись с использованием очереди (ЛР 4):

Threads | Requests/sec   | Latency(ms)
---     | ---            | ---
1       | 94.10          | 124.24
2       | 89.21          | 168.40
6       | 84.41          | 166.75
10      | 81.16          | 172.97

Запись без использования очереди (ЛР 4): (ЛР 1-3):

Threads | Requests/sec   | Latency(ms)
---     | ---            | ---
1       | 42.75          | 428.69
2       | 41.39          | 374.45
6       | 41.71          | 364.28
10      | 39.57          | 386.11

Чтение с использованием кэша (ЛР 2-4):

Threads | Requests/sec   | Latency(ms)
---     | ---            | ---
1       | 2788.10        | 6.13
2       | 3210.25        | 4.92
6       | 2924.30        | 5.27
10      | 2756.73        | 5.74

Чтение без использования кэша (ЛР 1):

Threads | Requests/sec | Latency(ms)
---     | ---          | ---
1       | 1.00k        | 22.70
2       | 638.59       | 15.09
6       | 218.50       | 12.01
10      | 132.12       | 12.67

## Очистка таблиц после нагрузочного тестирования ##

Для очистки таблиц шардов после нагрузочного тестирования необходимо выполнить следующие команды:

```bash
mysql -u test -p pzjqUkMnc7vfNHET -h 127.0.0.1 -P 6033 --comments
mysql> source db_scripts/shard_test_cleanup.sql;
```

## Остановка работы Docker-окружения ##

```bash
sudo docker-compose stop
```
